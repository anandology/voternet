$def with (place)

$var title: $place.name

<ul class="breadcrumb">
    $for p in place.get_parents():
        <li><a href="$p.get_url()">$p.name</a> <span class="divider"></span></li>
    <li class="active">$place.name</li>
</ul>

<div class="row">
  <div class="col-md-9">
    <h1>$place.name <span class="small">$place.type_label</span></h1>
    <a href="$place.url/info">See info about this place</a>
    <h2>Volunteers</h2>
    $if not place.volunteers:
        <em>None found.</em>
    $else:
        <table class="table">
            $for person in place.volunteers:
                <tr><td>$loop.index</td><td>$person.name</td><td>$person.email</td><td>$person.phone</td></tr>
        </table>
    <div>
        <br/>
        <a href="$place.get_url()/add-people">Add volunteers?</a>
    </div>
    <h2>Graphs</h2>
    $if place.subtype:
        <h2>$plural(place.subtype_label)</h2>
        <table class="table">
            $ subtypes = place.get_all_subtypes()
            $ serial = counter()
            <tr>
                <th>#</th>
                <th>Name</th>
                $for t in subtypes:
                    <th>$t.code</th>
            <tr> 
            $def render_place(p, klass):
                <tr class="$klass">   
                    <td>$serial.next()</td>             
                    <td><a href="$p.get_url()">$p.name</a></td>
                    $for t in subtypes:
                        <td>
                            <strong>$vcounts.get(t.code, 0)</strong> volunteers / 
                            <strong>$counts.get(t.code, 0)</strong> places
                        </td>
                </tr>

            $for p in place.get_places():
                $ counts = p.get_counts()
                $ vcounts = p.get_volunteer_counts()
                $if sum(vcounts.values()):
                    $:render_place(p, "active")

            $for p in place.get_places():
                $ counts = p.get_counts()
                $ vcounts = p.get_volunteer_counts()
                $if not sum(vcounts.values()):
                    $:render_place(p, "inactive")
        </table>    
  </div>
  <div class="col-md-3 sidebar">
    $if place.type != 'STATE':
        $for p in place.get_parents()[1:]:
            <div class="header">
                <a href="$p.get_url()">$p.name</a><br><small>$p.type_label</small>
            </div>

        <div class="header"><strong>$plural(place.type_label)</strong></div>

        <ul class="list-unstyled parents" style="padding: 10px;">
            $for p in place.parent.get_places():
                $if p.id == place.id:
                    <li><strong>$p.name</strong></li>
                $else:
                    <li><a href="$p.get_url()">$p.name</a></li>
        </ul>
  </div>
</div>

